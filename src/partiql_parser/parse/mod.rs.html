<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `/home/runner/.cargo/git/checkouts/partiql-lang-rust-80639ee88e7ff6e2/2c5d3e1/partiql-parser/src/parse/mod.rs`."><title>mod.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="partiql_parser" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (df871fbf0 2023-10-24)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../../../static.files/src-script-3280b574d94e47b4.js"></script><script defer src="../../../src-files.js"></script><script defer src="../../../static.files/main-5f34af1a0ee6bacd.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc src"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"></nav><main><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="example-wrap"><div data-nosnippet><pre class="src-line-numbers"><a href="#1" id="1">1</a>
<a href="#2" id="2">2</a>
<a href="#3" id="3">3</a>
<a href="#4" id="4">4</a>
<a href="#5" id="5">5</a>
<a href="#6" id="6">6</a>
<a href="#7" id="7">7</a>
<a href="#8" id="8">8</a>
<a href="#9" id="9">9</a>
<a href="#10" id="10">10</a>
<a href="#11" id="11">11</a>
<a href="#12" id="12">12</a>
<a href="#13" id="13">13</a>
<a href="#14" id="14">14</a>
<a href="#15" id="15">15</a>
<a href="#16" id="16">16</a>
<a href="#17" id="17">17</a>
<a href="#18" id="18">18</a>
<a href="#19" id="19">19</a>
<a href="#20" id="20">20</a>
<a href="#21" id="21">21</a>
<a href="#22" id="22">22</a>
<a href="#23" id="23">23</a>
<a href="#24" id="24">24</a>
<a href="#25" id="25">25</a>
<a href="#26" id="26">26</a>
<a href="#27" id="27">27</a>
<a href="#28" id="28">28</a>
<a href="#29" id="29">29</a>
<a href="#30" id="30">30</a>
<a href="#31" id="31">31</a>
<a href="#32" id="32">32</a>
<a href="#33" id="33">33</a>
<a href="#34" id="34">34</a>
<a href="#35" id="35">35</a>
<a href="#36" id="36">36</a>
<a href="#37" id="37">37</a>
<a href="#38" id="38">38</a>
<a href="#39" id="39">39</a>
<a href="#40" id="40">40</a>
<a href="#41" id="41">41</a>
<a href="#42" id="42">42</a>
<a href="#43" id="43">43</a>
<a href="#44" id="44">44</a>
<a href="#45" id="45">45</a>
<a href="#46" id="46">46</a>
<a href="#47" id="47">47</a>
<a href="#48" id="48">48</a>
<a href="#49" id="49">49</a>
<a href="#50" id="50">50</a>
<a href="#51" id="51">51</a>
<a href="#52" id="52">52</a>
<a href="#53" id="53">53</a>
<a href="#54" id="54">54</a>
<a href="#55" id="55">55</a>
<a href="#56" id="56">56</a>
<a href="#57" id="57">57</a>
<a href="#58" id="58">58</a>
<a href="#59" id="59">59</a>
<a href="#60" id="60">60</a>
<a href="#61" id="61">61</a>
<a href="#62" id="62">62</a>
<a href="#63" id="63">63</a>
<a href="#64" id="64">64</a>
<a href="#65" id="65">65</a>
<a href="#66" id="66">66</a>
<a href="#67" id="67">67</a>
<a href="#68" id="68">68</a>
<a href="#69" id="69">69</a>
<a href="#70" id="70">70</a>
<a href="#71" id="71">71</a>
<a href="#72" id="72">72</a>
<a href="#73" id="73">73</a>
<a href="#74" id="74">74</a>
<a href="#75" id="75">75</a>
<a href="#76" id="76">76</a>
<a href="#77" id="77">77</a>
<a href="#78" id="78">78</a>
<a href="#79" id="79">79</a>
<a href="#80" id="80">80</a>
<a href="#81" id="81">81</a>
<a href="#82" id="82">82</a>
<a href="#83" id="83">83</a>
<a href="#84" id="84">84</a>
<a href="#85" id="85">85</a>
<a href="#86" id="86">86</a>
<a href="#87" id="87">87</a>
<a href="#88" id="88">88</a>
<a href="#89" id="89">89</a>
<a href="#90" id="90">90</a>
<a href="#91" id="91">91</a>
<a href="#92" id="92">92</a>
<a href="#93" id="93">93</a>
<a href="#94" id="94">94</a>
<a href="#95" id="95">95</a>
<a href="#96" id="96">96</a>
<a href="#97" id="97">97</a>
<a href="#98" id="98">98</a>
<a href="#99" id="99">99</a>
<a href="#100" id="100">100</a>
<a href="#101" id="101">101</a>
<a href="#102" id="102">102</a>
<a href="#103" id="103">103</a>
<a href="#104" id="104">104</a>
<a href="#105" id="105">105</a>
<a href="#106" id="106">106</a>
<a href="#107" id="107">107</a>
<a href="#108" id="108">108</a>
<a href="#109" id="109">109</a>
<a href="#110" id="110">110</a>
<a href="#111" id="111">111</a>
<a href="#112" id="112">112</a>
<a href="#113" id="113">113</a>
<a href="#114" id="114">114</a>
<a href="#115" id="115">115</a>
<a href="#116" id="116">116</a>
<a href="#117" id="117">117</a>
<a href="#118" id="118">118</a>
<a href="#119" id="119">119</a>
<a href="#120" id="120">120</a>
<a href="#121" id="121">121</a>
<a href="#122" id="122">122</a>
<a href="#123" id="123">123</a>
<a href="#124" id="124">124</a>
<a href="#125" id="125">125</a>
<a href="#126" id="126">126</a>
<a href="#127" id="127">127</a>
<a href="#128" id="128">128</a>
<a href="#129" id="129">129</a>
<a href="#130" id="130">130</a>
<a href="#131" id="131">131</a>
<a href="#132" id="132">132</a>
<a href="#133" id="133">133</a>
<a href="#134" id="134">134</a>
<a href="#135" id="135">135</a>
<a href="#136" id="136">136</a>
<a href="#137" id="137">137</a>
<a href="#138" id="138">138</a>
<a href="#139" id="139">139</a>
<a href="#140" id="140">140</a>
<a href="#141" id="141">141</a>
<a href="#142" id="142">142</a>
<a href="#143" id="143">143</a>
<a href="#144" id="144">144</a>
<a href="#145" id="145">145</a>
<a href="#146" id="146">146</a>
<a href="#147" id="147">147</a>
<a href="#148" id="148">148</a>
<a href="#149" id="149">149</a>
<a href="#150" id="150">150</a>
<a href="#151" id="151">151</a>
<a href="#152" id="152">152</a>
<a href="#153" id="153">153</a>
<a href="#154" id="154">154</a>
<a href="#155" id="155">155</a>
<a href="#156" id="156">156</a>
<a href="#157" id="157">157</a>
<a href="#158" id="158">158</a>
<a href="#159" id="159">159</a>
<a href="#160" id="160">160</a>
<a href="#161" id="161">161</a>
<a href="#162" id="162">162</a>
<a href="#163" id="163">163</a>
<a href="#164" id="164">164</a>
<a href="#165" id="165">165</a>
<a href="#166" id="166">166</a>
<a href="#167" id="167">167</a>
<a href="#168" id="168">168</a>
<a href="#169" id="169">169</a>
<a href="#170" id="170">170</a>
<a href="#171" id="171">171</a>
<a href="#172" id="172">172</a>
<a href="#173" id="173">173</a>
<a href="#174" id="174">174</a>
<a href="#175" id="175">175</a>
<a href="#176" id="176">176</a>
<a href="#177" id="177">177</a>
<a href="#178" id="178">178</a>
<a href="#179" id="179">179</a>
<a href="#180" id="180">180</a>
<a href="#181" id="181">181</a>
<a href="#182" id="182">182</a>
<a href="#183" id="183">183</a>
<a href="#184" id="184">184</a>
<a href="#185" id="185">185</a>
<a href="#186" id="186">186</a>
<a href="#187" id="187">187</a>
<a href="#188" id="188">188</a>
<a href="#189" id="189">189</a>
<a href="#190" id="190">190</a>
<a href="#191" id="191">191</a>
<a href="#192" id="192">192</a>
<a href="#193" id="193">193</a>
<a href="#194" id="194">194</a>
<a href="#195" id="195">195</a>
<a href="#196" id="196">196</a>
<a href="#197" id="197">197</a>
<a href="#198" id="198">198</a>
<a href="#199" id="199">199</a>
<a href="#200" id="200">200</a>
<a href="#201" id="201">201</a>
<a href="#202" id="202">202</a>
<a href="#203" id="203">203</a>
<a href="#204" id="204">204</a>
<a href="#205" id="205">205</a>
<a href="#206" id="206">206</a>
<a href="#207" id="207">207</a>
<a href="#208" id="208">208</a>
<a href="#209" id="209">209</a>
<a href="#210" id="210">210</a>
<a href="#211" id="211">211</a>
<a href="#212" id="212">212</a>
<a href="#213" id="213">213</a>
<a href="#214" id="214">214</a>
<a href="#215" id="215">215</a>
<a href="#216" id="216">216</a>
<a href="#217" id="217">217</a>
<a href="#218" id="218">218</a>
<a href="#219" id="219">219</a>
<a href="#220" id="220">220</a>
<a href="#221" id="221">221</a>
<a href="#222" id="222">222</a>
<a href="#223" id="223">223</a>
<a href="#224" id="224">224</a>
<a href="#225" id="225">225</a>
<a href="#226" id="226">226</a>
<a href="#227" id="227">227</a>
<a href="#228" id="228">228</a>
<a href="#229" id="229">229</a>
<a href="#230" id="230">230</a>
<a href="#231" id="231">231</a>
<a href="#232" id="232">232</a>
<a href="#233" id="233">233</a>
<a href="#234" id="234">234</a>
<a href="#235" id="235">235</a>
<a href="#236" id="236">236</a>
<a href="#237" id="237">237</a>
<a href="#238" id="238">238</a>
<a href="#239" id="239">239</a>
<a href="#240" id="240">240</a>
<a href="#241" id="241">241</a>
<a href="#242" id="242">242</a>
<a href="#243" id="243">243</a>
<a href="#244" id="244">244</a>
<a href="#245" id="245">245</a>
<a href="#246" id="246">246</a>
<a href="#247" id="247">247</a>
<a href="#248" id="248">248</a>
<a href="#249" id="249">249</a>
<a href="#250" id="250">250</a>
<a href="#251" id="251">251</a>
<a href="#252" id="252">252</a>
<a href="#253" id="253">253</a>
<a href="#254" id="254">254</a>
<a href="#255" id="255">255</a>
<a href="#256" id="256">256</a>
<a href="#257" id="257">257</a>
<a href="#258" id="258">258</a>
<a href="#259" id="259">259</a>
<a href="#260" id="260">260</a>
<a href="#261" id="261">261</a>
<a href="#262" id="262">262</a>
<a href="#263" id="263">263</a>
<a href="#264" id="264">264</a>
<a href="#265" id="265">265</a>
<a href="#266" id="266">266</a>
<a href="#267" id="267">267</a>
<a href="#268" id="268">268</a>
<a href="#269" id="269">269</a>
<a href="#270" id="270">270</a>
<a href="#271" id="271">271</a>
<a href="#272" id="272">272</a>
<a href="#273" id="273">273</a>
<a href="#274" id="274">274</a>
<a href="#275" id="275">275</a>
<a href="#276" id="276">276</a>
<a href="#277" id="277">277</a>
<a href="#278" id="278">278</a>
<a href="#279" id="279">279</a>
<a href="#280" id="280">280</a>
<a href="#281" id="281">281</a>
<a href="#282" id="282">282</a>
<a href="#283" id="283">283</a>
<a href="#284" id="284">284</a>
<a href="#285" id="285">285</a>
<a href="#286" id="286">286</a>
<a href="#287" id="287">287</a>
<a href="#288" id="288">288</a>
<a href="#289" id="289">289</a>
<a href="#290" id="290">290</a>
<a href="#291" id="291">291</a>
<a href="#292" id="292">292</a>
<a href="#293" id="293">293</a>
<a href="#294" id="294">294</a>
<a href="#295" id="295">295</a>
<a href="#296" id="296">296</a>
<a href="#297" id="297">297</a>
<a href="#298" id="298">298</a>
<a href="#299" id="299">299</a>
<a href="#300" id="300">300</a>
<a href="#301" id="301">301</a>
<a href="#302" id="302">302</a>
<a href="#303" id="303">303</a>
<a href="#304" id="304">304</a>
<a href="#305" id="305">305</a>
<a href="#306" id="306">306</a>
<a href="#307" id="307">307</a>
<a href="#308" id="308">308</a>
<a href="#309" id="309">309</a>
<a href="#310" id="310">310</a>
<a href="#311" id="311">311</a>
<a href="#312" id="312">312</a>
<a href="#313" id="313">313</a>
<a href="#314" id="314">314</a>
<a href="#315" id="315">315</a>
<a href="#316" id="316">316</a>
<a href="#317" id="317">317</a>
<a href="#318" id="318">318</a>
<a href="#319" id="319">319</a>
<a href="#320" id="320">320</a>
<a href="#321" id="321">321</a>
<a href="#322" id="322">322</a>
<a href="#323" id="323">323</a>
<a href="#324" id="324">324</a>
<a href="#325" id="325">325</a>
<a href="#326" id="326">326</a>
<a href="#327" id="327">327</a>
<a href="#328" id="328">328</a>
<a href="#329" id="329">329</a>
<a href="#330" id="330">330</a>
<a href="#331" id="331">331</a>
<a href="#332" id="332">332</a>
<a href="#333" id="333">333</a>
<a href="#334" id="334">334</a>
<a href="#335" id="335">335</a>
<a href="#336" id="336">336</a>
<a href="#337" id="337">337</a>
<a href="#338" id="338">338</a>
<a href="#339" id="339">339</a>
<a href="#340" id="340">340</a>
<a href="#341" id="341">341</a>
<a href="#342" id="342">342</a>
<a href="#343" id="343">343</a>
<a href="#344" id="344">344</a>
<a href="#345" id="345">345</a>
<a href="#346" id="346">346</a>
<a href="#347" id="347">347</a>
<a href="#348" id="348">348</a>
<a href="#349" id="349">349</a>
<a href="#350" id="350">350</a>
<a href="#351" id="351">351</a>
<a href="#352" id="352">352</a>
<a href="#353" id="353">353</a>
<a href="#354" id="354">354</a>
<a href="#355" id="355">355</a>
<a href="#356" id="356">356</a>
<a href="#357" id="357">357</a>
<a href="#358" id="358">358</a>
<a href="#359" id="359">359</a>
<a href="#360" id="360">360</a>
<a href="#361" id="361">361</a>
<a href="#362" id="362">362</a>
<a href="#363" id="363">363</a>
<a href="#364" id="364">364</a>
<a href="#365" id="365">365</a>
<a href="#366" id="366">366</a>
<a href="#367" id="367">367</a>
<a href="#368" id="368">368</a>
<a href="#369" id="369">369</a>
<a href="#370" id="370">370</a>
<a href="#371" id="371">371</a>
<a href="#372" id="372">372</a>
<a href="#373" id="373">373</a>
<a href="#374" id="374">374</a>
<a href="#375" id="375">375</a>
<a href="#376" id="376">376</a>
<a href="#377" id="377">377</a>
<a href="#378" id="378">378</a>
<a href="#379" id="379">379</a>
<a href="#380" id="380">380</a>
<a href="#381" id="381">381</a>
<a href="#382" id="382">382</a>
<a href="#383" id="383">383</a>
<a href="#384" id="384">384</a>
<a href="#385" id="385">385</a>
<a href="#386" id="386">386</a>
<a href="#387" id="387">387</a>
<a href="#388" id="388">388</a>
<a href="#389" id="389">389</a>
<a href="#390" id="390">390</a>
<a href="#391" id="391">391</a>
<a href="#392" id="392">392</a>
<a href="#393" id="393">393</a>
<a href="#394" id="394">394</a>
<a href="#395" id="395">395</a>
<a href="#396" id="396">396</a>
<a href="#397" id="397">397</a>
<a href="#398" id="398">398</a>
<a href="#399" id="399">399</a>
<a href="#400" id="400">400</a>
<a href="#401" id="401">401</a>
<a href="#402" id="402">402</a>
<a href="#403" id="403">403</a>
<a href="#404" id="404">404</a>
<a href="#405" id="405">405</a>
<a href="#406" id="406">406</a>
<a href="#407" id="407">407</a>
<a href="#408" id="408">408</a>
<a href="#409" id="409">409</a>
<a href="#410" id="410">410</a>
<a href="#411" id="411">411</a>
<a href="#412" id="412">412</a>
<a href="#413" id="413">413</a>
<a href="#414" id="414">414</a>
<a href="#415" id="415">415</a>
<a href="#416" id="416">416</a>
<a href="#417" id="417">417</a>
<a href="#418" id="418">418</a>
<a href="#419" id="419">419</a>
<a href="#420" id="420">420</a>
<a href="#421" id="421">421</a>
<a href="#422" id="422">422</a>
<a href="#423" id="423">423</a>
<a href="#424" id="424">424</a>
<a href="#425" id="425">425</a>
<a href="#426" id="426">426</a>
<a href="#427" id="427">427</a>
<a href="#428" id="428">428</a>
<a href="#429" id="429">429</a>
<a href="#430" id="430">430</a>
<a href="#431" id="431">431</a>
<a href="#432" id="432">432</a>
<a href="#433" id="433">433</a>
<a href="#434" id="434">434</a>
<a href="#435" id="435">435</a>
<a href="#436" id="436">436</a>
<a href="#437" id="437">437</a>
<a href="#438" id="438">438</a>
<a href="#439" id="439">439</a>
<a href="#440" id="440">440</a>
<a href="#441" id="441">441</a>
<a href="#442" id="442">442</a>
<a href="#443" id="443">443</a>
<a href="#444" id="444">444</a>
<a href="#445" id="445">445</a>
<a href="#446" id="446">446</a>
<a href="#447" id="447">447</a>
<a href="#448" id="448">448</a>
<a href="#449" id="449">449</a>
<a href="#450" id="450">450</a>
<a href="#451" id="451">451</a>
<a href="#452" id="452">452</a>
<a href="#453" id="453">453</a>
<a href="#454" id="454">454</a>
<a href="#455" id="455">455</a>
<a href="#456" id="456">456</a>
<a href="#457" id="457">457</a>
<a href="#458" id="458">458</a>
<a href="#459" id="459">459</a>
<a href="#460" id="460">460</a>
<a href="#461" id="461">461</a>
<a href="#462" id="462">462</a>
<a href="#463" id="463">463</a>
<a href="#464" id="464">464</a>
<a href="#465" id="465">465</a>
<a href="#466" id="466">466</a>
<a href="#467" id="467">467</a>
<a href="#468" id="468">468</a>
<a href="#469" id="469">469</a>
<a href="#470" id="470">470</a>
<a href="#471" id="471">471</a>
<a href="#472" id="472">472</a>
<a href="#473" id="473">473</a>
<a href="#474" id="474">474</a>
<a href="#475" id="475">475</a>
<a href="#476" id="476">476</a>
<a href="#477" id="477">477</a>
<a href="#478" id="478">478</a>
<a href="#479" id="479">479</a>
<a href="#480" id="480">480</a>
<a href="#481" id="481">481</a>
<a href="#482" id="482">482</a>
<a href="#483" id="483">483</a>
<a href="#484" id="484">484</a>
<a href="#485" id="485">485</a>
<a href="#486" id="486">486</a>
<a href="#487" id="487">487</a>
<a href="#488" id="488">488</a>
<a href="#489" id="489">489</a>
<a href="#490" id="490">490</a>
<a href="#491" id="491">491</a>
<a href="#492" id="492">492</a>
<a href="#493" id="493">493</a>
<a href="#494" id="494">494</a>
<a href="#495" id="495">495</a>
<a href="#496" id="496">496</a>
<a href="#497" id="497">497</a>
<a href="#498" id="498">498</a>
<a href="#499" id="499">499</a>
<a href="#500" id="500">500</a>
<a href="#501" id="501">501</a>
<a href="#502" id="502">502</a>
<a href="#503" id="503">503</a>
<a href="#504" id="504">504</a>
<a href="#505" id="505">505</a>
<a href="#506" id="506">506</a>
<a href="#507" id="507">507</a>
<a href="#508" id="508">508</a>
<a href="#509" id="509">509</a>
<a href="#510" id="510">510</a>
<a href="#511" id="511">511</a>
<a href="#512" id="512">512</a>
<a href="#513" id="513">513</a>
<a href="#514" id="514">514</a>
<a href="#515" id="515">515</a>
<a href="#516" id="516">516</a>
<a href="#517" id="517">517</a>
<a href="#518" id="518">518</a>
<a href="#519" id="519">519</a>
<a href="#520" id="520">520</a>
<a href="#521" id="521">521</a>
<a href="#522" id="522">522</a>
<a href="#523" id="523">523</a>
<a href="#524" id="524">524</a>
<a href="#525" id="525">525</a>
<a href="#526" id="526">526</a>
<a href="#527" id="527">527</a>
<a href="#528" id="528">528</a>
<a href="#529" id="529">529</a>
<a href="#530" id="530">530</a>
<a href="#531" id="531">531</a>
<a href="#532" id="532">532</a>
<a href="#533" id="533">533</a>
<a href="#534" id="534">534</a>
<a href="#535" id="535">535</a>
<a href="#536" id="536">536</a>
<a href="#537" id="537">537</a>
<a href="#538" id="538">538</a>
<a href="#539" id="539">539</a>
<a href="#540" id="540">540</a>
<a href="#541" id="541">541</a>
<a href="#542" id="542">542</a>
<a href="#543" id="543">543</a>
<a href="#544" id="544">544</a>
<a href="#545" id="545">545</a>
<a href="#546" id="546">546</a>
<a href="#547" id="547">547</a>
<a href="#548" id="548">548</a>
<a href="#549" id="549">549</a>
<a href="#550" id="550">550</a>
<a href="#551" id="551">551</a>
<a href="#552" id="552">552</a>
<a href="#553" id="553">553</a>
<a href="#554" id="554">554</a>
<a href="#555" id="555">555</a>
<a href="#556" id="556">556</a>
<a href="#557" id="557">557</a>
<a href="#558" id="558">558</a>
<a href="#559" id="559">559</a>
<a href="#560" id="560">560</a>
<a href="#561" id="561">561</a>
<a href="#562" id="562">562</a>
<a href="#563" id="563">563</a>
<a href="#564" id="564">564</a>
<a href="#565" id="565">565</a>
<a href="#566" id="566">566</a>
<a href="#567" id="567">567</a>
<a href="#568" id="568">568</a>
<a href="#569" id="569">569</a>
<a href="#570" id="570">570</a>
<a href="#571" id="571">571</a>
<a href="#572" id="572">572</a>
<a href="#573" id="573">573</a>
<a href="#574" id="574">574</a>
<a href="#575" id="575">575</a>
<a href="#576" id="576">576</a>
<a href="#577" id="577">577</a>
<a href="#578" id="578">578</a>
<a href="#579" id="579">579</a>
<a href="#580" id="580">580</a>
<a href="#581" id="581">581</a>
<a href="#582" id="582">582</a>
<a href="#583" id="583">583</a>
<a href="#584" id="584">584</a>
<a href="#585" id="585">585</a>
<a href="#586" id="586">586</a>
<a href="#587" id="587">587</a>
<a href="#588" id="588">588</a>
<a href="#589" id="589">589</a>
<a href="#590" id="590">590</a>
<a href="#591" id="591">591</a>
<a href="#592" id="592">592</a>
<a href="#593" id="593">593</a>
<a href="#594" id="594">594</a>
<a href="#595" id="595">595</a>
<a href="#596" id="596">596</a>
<a href="#597" id="597">597</a>
<a href="#598" id="598">598</a>
<a href="#599" id="599">599</a>
<a href="#600" id="600">600</a>
<a href="#601" id="601">601</a>
<a href="#602" id="602">602</a>
<a href="#603" id="603">603</a>
<a href="#604" id="604">604</a>
<a href="#605" id="605">605</a>
<a href="#606" id="606">606</a>
<a href="#607" id="607">607</a>
<a href="#608" id="608">608</a>
<a href="#609" id="609">609</a>
<a href="#610" id="610">610</a>
<a href="#611" id="611">611</a>
<a href="#612" id="612">612</a>
<a href="#613" id="613">613</a>
<a href="#614" id="614">614</a>
<a href="#615" id="615">615</a>
<a href="#616" id="616">616</a>
<a href="#617" id="617">617</a>
<a href="#618" id="618">618</a>
<a href="#619" id="619">619</a>
<a href="#620" id="620">620</a>
<a href="#621" id="621">621</a>
<a href="#622" id="622">622</a>
<a href="#623" id="623">623</a>
<a href="#624" id="624">624</a>
<a href="#625" id="625">625</a>
<a href="#626" id="626">626</a>
<a href="#627" id="627">627</a>
<a href="#628" id="628">628</a>
<a href="#629" id="629">629</a>
<a href="#630" id="630">630</a>
<a href="#631" id="631">631</a>
<a href="#632" id="632">632</a>
<a href="#633" id="633">633</a>
<a href="#634" id="634">634</a>
<a href="#635" id="635">635</a>
<a href="#636" id="636">636</a>
<a href="#637" id="637">637</a>
<a href="#638" id="638">638</a>
<a href="#639" id="639">639</a>
<a href="#640" id="640">640</a>
<a href="#641" id="641">641</a>
<a href="#642" id="642">642</a>
<a href="#643" id="643">643</a>
<a href="#644" id="644">644</a>
<a href="#645" id="645">645</a>
<a href="#646" id="646">646</a>
<a href="#647" id="647">647</a>
<a href="#648" id="648">648</a>
<a href="#649" id="649">649</a>
<a href="#650" id="650">650</a>
<a href="#651" id="651">651</a>
<a href="#652" id="652">652</a>
<a href="#653" id="653">653</a>
<a href="#654" id="654">654</a>
<a href="#655" id="655">655</a>
<a href="#656" id="656">656</a>
<a href="#657" id="657">657</a>
<a href="#658" id="658">658</a>
<a href="#659" id="659">659</a>
<a href="#660" id="660">660</a>
<a href="#661" id="661">661</a>
<a href="#662" id="662">662</a>
<a href="#663" id="663">663</a>
<a href="#664" id="664">664</a>
<a href="#665" id="665">665</a>
<a href="#666" id="666">666</a>
<a href="#667" id="667">667</a>
<a href="#668" id="668">668</a>
<a href="#669" id="669">669</a>
<a href="#670" id="670">670</a>
<a href="#671" id="671">671</a>
<a href="#672" id="672">672</a>
<a href="#673" id="673">673</a>
<a href="#674" id="674">674</a>
<a href="#675" id="675">675</a>
<a href="#676" id="676">676</a>
<a href="#677" id="677">677</a>
<a href="#678" id="678">678</a>
<a href="#679" id="679">679</a>
<a href="#680" id="680">680</a>
<a href="#681" id="681">681</a>
<a href="#682" id="682">682</a>
<a href="#683" id="683">683</a>
<a href="#684" id="684">684</a>
<a href="#685" id="685">685</a>
<a href="#686" id="686">686</a>
<a href="#687" id="687">687</a>
<a href="#688" id="688">688</a>
<a href="#689" id="689">689</a>
<a href="#690" id="690">690</a>
<a href="#691" id="691">691</a>
<a href="#692" id="692">692</a>
<a href="#693" id="693">693</a>
<a href="#694" id="694">694</a>
<a href="#695" id="695">695</a>
<a href="#696" id="696">696</a>
<a href="#697" id="697">697</a>
<a href="#698" id="698">698</a>
<a href="#699" id="699">699</a>
<a href="#700" id="700">700</a>
<a href="#701" id="701">701</a>
<a href="#702" id="702">702</a>
<a href="#703" id="703">703</a>
<a href="#704" id="704">704</a>
<a href="#705" id="705">705</a>
<a href="#706" id="706">706</a>
<a href="#707" id="707">707</a>
<a href="#708" id="708">708</a>
<a href="#709" id="709">709</a>
<a href="#710" id="710">710</a>
<a href="#711" id="711">711</a>
<a href="#712" id="712">712</a>
<a href="#713" id="713">713</a>
<a href="#714" id="714">714</a>
<a href="#715" id="715">715</a>
<a href="#716" id="716">716</a>
<a href="#717" id="717">717</a>
<a href="#718" id="718">718</a>
<a href="#719" id="719">719</a>
<a href="#720" id="720">720</a>
<a href="#721" id="721">721</a>
<a href="#722" id="722">722</a>
<a href="#723" id="723">723</a>
<a href="#724" id="724">724</a>
<a href="#725" id="725">725</a>
<a href="#726" id="726">726</a>
<a href="#727" id="727">727</a>
<a href="#728" id="728">728</a>
<a href="#729" id="729">729</a>
<a href="#730" id="730">730</a>
<a href="#731" id="731">731</a>
<a href="#732" id="732">732</a>
<a href="#733" id="733">733</a>
<a href="#734" id="734">734</a>
<a href="#735" id="735">735</a>
<a href="#736" id="736">736</a>
<a href="#737" id="737">737</a>
<a href="#738" id="738">738</a>
<a href="#739" id="739">739</a>
<a href="#740" id="740">740</a>
<a href="#741" id="741">741</a>
<a href="#742" id="742">742</a>
<a href="#743" id="743">743</a>
<a href="#744" id="744">744</a>
<a href="#745" id="745">745</a>
<a href="#746" id="746">746</a>
<a href="#747" id="747">747</a>
<a href="#748" id="748">748</a>
<a href="#749" id="749">749</a>
<a href="#750" id="750">750</a>
<a href="#751" id="751">751</a>
<a href="#752" id="752">752</a>
<a href="#753" id="753">753</a>
<a href="#754" id="754">754</a>
<a href="#755" id="755">755</a>
<a href="#756" id="756">756</a>
<a href="#757" id="757">757</a>
<a href="#758" id="758">758</a>
<a href="#759" id="759">759</a>
<a href="#760" id="760">760</a>
<a href="#761" id="761">761</a>
<a href="#762" id="762">762</a>
<a href="#763" id="763">763</a>
<a href="#764" id="764">764</a>
<a href="#765" id="765">765</a>
<a href="#766" id="766">766</a>
<a href="#767" id="767">767</a>
<a href="#768" id="768">768</a>
<a href="#769" id="769">769</a>
<a href="#770" id="770">770</a>
<a href="#771" id="771">771</a>
<a href="#772" id="772">772</a>
<a href="#773" id="773">773</a>
<a href="#774" id="774">774</a>
<a href="#775" id="775">775</a>
<a href="#776" id="776">776</a>
<a href="#777" id="777">777</a>
<a href="#778" id="778">778</a>
<a href="#779" id="779">779</a>
<a href="#780" id="780">780</a>
<a href="#781" id="781">781</a>
<a href="#782" id="782">782</a>
<a href="#783" id="783">783</a>
<a href="#784" id="784">784</a>
<a href="#785" id="785">785</a>
<a href="#786" id="786">786</a>
<a href="#787" id="787">787</a>
<a href="#788" id="788">788</a>
<a href="#789" id="789">789</a>
<a href="#790" id="790">790</a>
<a href="#791" id="791">791</a>
<a href="#792" id="792">792</a>
<a href="#793" id="793">793</a>
<a href="#794" id="794">794</a>
<a href="#795" id="795">795</a>
<a href="#796" id="796">796</a>
<a href="#797" id="797">797</a>
<a href="#798" id="798">798</a>
<a href="#799" id="799">799</a>
<a href="#800" id="800">800</a>
<a href="#801" id="801">801</a>
<a href="#802" id="802">802</a>
<a href="#803" id="803">803</a>
<a href="#804" id="804">804</a>
<a href="#805" id="805">805</a>
<a href="#806" id="806">806</a>
<a href="#807" id="807">807</a>
<a href="#808" id="808">808</a>
<a href="#809" id="809">809</a>
<a href="#810" id="810">810</a>
<a href="#811" id="811">811</a>
<a href="#812" id="812">812</a>
<a href="#813" id="813">813</a>
<a href="#814" id="814">814</a>
<a href="#815" id="815">815</a>
<a href="#816" id="816">816</a>
<a href="#817" id="817">817</a>
<a href="#818" id="818">818</a>
<a href="#819" id="819">819</a>
<a href="#820" id="820">820</a>
</pre></div><pre class="rust"><code><span class="comment">// Copyright Amazon.com, Inc. or its affiliates.

</span><span class="doccomment">//! Provides the [`parse_partiql`] function to parse a PartiQL query.

</span><span class="kw">mod </span>parse_util;
<span class="kw">mod </span>parser_state;

<span class="kw">use </span><span class="kw">crate</span>::error::{ParseError, UnexpectedTokenData};
<span class="kw">use </span><span class="kw">crate</span>::lexer;
<span class="kw">use </span><span class="kw">crate</span>::lexer::CommentSkippingLexer;
<span class="kw">use </span><span class="kw">crate</span>::parse::parser_state::{IdGenerator, ParserState};
<span class="kw">use </span><span class="kw">crate</span>::preprocessor::{PreprocessingPartiqlLexer, BUILT_INS};
<span class="kw">use </span>lalrpop_util <span class="kw">as </span>lpop;
<span class="kw">use </span>partiql_ast::ast;
<span class="kw">use </span>partiql_source_map::line_offset_tracker::LineOffsetTracker;
<span class="kw">use </span>partiql_source_map::location::{ByteOffset, BytePosition, ToLocated};
<span class="kw">use </span>partiql_source_map::metadata::LocationMap;

<span class="attr">#[allow(clippy::just_underscores_and_digits)] </span><span class="comment">// LALRPOP generates a lot of names like this
</span><span class="attr">#[allow(clippy::clone_on_copy)]
#[allow(clippy::type_complexity)]
#[allow(clippy::needless_lifetimes)]
#[allow(clippy::too_many_arguments)]
#[allow(clippy::ptr_arg)]
#[allow(clippy::vec_box)]
#[allow(clippy::let_unit_value)]
#[allow(clippy::unused_unit)]
#[allow(unused_variables)]
#[allow(dead_code)]
</span><span class="kw">mod </span>grammar {
    <span class="macro">include!</span>(<span class="macro">concat!</span>(<span class="macro">env!</span>(<span class="string">&quot;OUT_DIR&quot;</span>), <span class="string">&quot;/partiql.rs&quot;</span>));
}

<span class="kw">type </span>LalrpopError&lt;<span class="lifetime">&#39;input</span>&gt; =
    lpop::ParseError&lt;ByteOffset, lexer::Token&lt;<span class="lifetime">&#39;input</span>&gt;, ParseError&lt;<span class="lifetime">&#39;input</span>, BytePosition&gt;&gt;;
<span class="kw">type </span>LalrpopResult&lt;<span class="lifetime">&#39;input</span>&gt; = <span class="prelude-ty">Result</span>&lt;ast::AstNode&lt;ast::TopLevelQuery&gt;, LalrpopError&lt;<span class="lifetime">&#39;input</span>&gt;&gt;;
<span class="kw">type </span>LalrpopErrorRecovery&lt;<span class="lifetime">&#39;input</span>&gt; =
    lpop::ErrorRecovery&lt;ByteOffset, lexer::Token&lt;<span class="lifetime">&#39;input</span>&gt;, ParseError&lt;<span class="lifetime">&#39;input</span>, BytePosition&gt;&gt;;

<span class="attr">#[derive(Debug, Clone)]
</span><span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct </span>AstData {
    <span class="kw">pub </span>ast: ast::AstNode&lt;ast::TopLevelQuery&gt;,
    <span class="kw">pub </span>locations: LocationMap,
    <span class="kw">pub </span>offsets: LineOffsetTracker,
}

<span class="attr">#[derive(Debug, Clone)]
</span><span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct </span>ErrorData&lt;<span class="lifetime">&#39;input</span>&gt; {
    <span class="kw">pub </span>errors: Vec&lt;ParseError&lt;<span class="lifetime">&#39;input</span>, BytePosition&gt;&gt;,
    <span class="kw">pub </span>offsets: LineOffsetTracker,
}

<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">type </span>AstResult&lt;<span class="lifetime">&#39;input</span>&gt; = <span class="prelude-ty">Result</span>&lt;AstData, ErrorData&lt;<span class="lifetime">&#39;input</span>&gt;&gt;;

<span class="doccomment">/// Parse PartiQL query text into an AST.
</span><span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>parse_partiql(s: <span class="kw-2">&amp;</span>str) -&gt; AstResult {
    parse_partiql_with_state(s, ParserState::default())
}

<span class="kw">fn </span>parse_partiql_with_state&lt;<span class="lifetime">&#39;input</span>, Id: IdGenerator&gt;(
    s: <span class="kw-2">&amp;</span><span class="lifetime">&#39;input </span>str,
    <span class="kw-2">mut </span>state: ParserState&lt;<span class="lifetime">&#39;input</span>, Id&gt;,
) -&gt; AstResult&lt;<span class="lifetime">&#39;input</span>&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>offsets = LineOffsetTracker::default();
    <span class="kw">let </span>lexer = PreprocessingPartiqlLexer::new(s, <span class="kw-2">&amp;mut </span>offsets, <span class="kw-2">&amp;</span>BUILT_INS);
    <span class="kw">let </span>lexer = CommentSkippingLexer::new(lexer);

    <span class="kw">let </span>result: LalrpopResult = grammar::TopLevelQueryParser::new().parse(s, <span class="kw-2">&amp;mut </span>state, lexer);

    <span class="kw">let </span>ParserState {
        locations, errors, ..
    } = state;

    <span class="kw">let </span><span class="kw-2">mut </span>errors: Vec&lt;<span class="kw">_</span>&gt; = errors
        .into_iter()
        <span class="comment">// TODO do something with error_recovery.dropped_tokens?
        </span>.map(|e| ParseError::from(e.error))
        .collect();

    <span class="kw">match </span>(result, errors.is_empty()) {
        (<span class="prelude-val">Ok</span>(<span class="kw">_</span>), <span class="bool-val">false</span>) =&gt; <span class="prelude-val">Err</span>(ErrorData { errors, offsets }),
        (<span class="prelude-val">Err</span>(e), <span class="bool-val">true</span>) =&gt; {
            <span class="kw">let </span>errors = <span class="macro">vec!</span>[ParseError::from(e)];
            <span class="prelude-val">Err</span>(ErrorData { errors, offsets })
        }
        (<span class="prelude-val">Err</span>(e), <span class="bool-val">false</span>) =&gt; {
            errors.push(ParseError::from(e));
            <span class="prelude-val">Err</span>(ErrorData { errors, offsets })
        }
        (<span class="prelude-val">Ok</span>(ast), <span class="bool-val">true</span>) =&gt; <span class="prelude-val">Ok</span>(AstData {
            ast,
            locations,
            offsets,
        }),
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;input</span>&gt; From&lt;LalrpopErrorRecovery&lt;<span class="lifetime">&#39;input</span>&gt;&gt; <span class="kw">for </span>ParseError&lt;<span class="lifetime">&#39;input</span>, BytePosition&gt; {
    <span class="kw">fn </span>from(error_recovery: LalrpopErrorRecovery&lt;<span class="lifetime">&#39;input</span>&gt;) -&gt; <span class="self">Self </span>{
        <span class="comment">// TODO do something with error_recovery.dropped_tokens?
        </span>error_recovery.error.into()
    }
}

<span class="kw">impl</span>&lt;<span class="lifetime">&#39;input</span>&gt; From&lt;LalrpopError&lt;<span class="lifetime">&#39;input</span>&gt;&gt; <span class="kw">for </span>ParseError&lt;<span class="lifetime">&#39;input</span>, BytePosition&gt; {
    <span class="attr">#[inline]
    </span><span class="kw">fn </span>from(error: LalrpopError&lt;<span class="lifetime">&#39;input</span>&gt;) -&gt; <span class="self">Self </span>{
        <span class="kw">match </span>error {
            <span class="comment">// TODO do something with UnrecognizedToken.expected
            </span>lalrpop_util::ParseError::UnrecognizedToken {
                token: (start, token, end),
                expected: <span class="kw">_</span>,
            } =&gt; ParseError::UnexpectedToken(
                UnexpectedTokenData {
                    token: token.to_string().into(),
                }
                .to_located(start.into()..end.into()),
            ),

            lalrpop_util::ParseError::InvalidToken { location } =&gt; {
                ParseError::Unknown(location.into())
            }

            <span class="comment">// TODO do something with UnrecognizedEof.expected
            </span>lalrpop_util::ParseError::UnrecognizedEof { expected: <span class="kw">_</span>, .. } =&gt; {
                ParseError::UnexpectedEndOfInput
            }

            lalrpop_util::ParseError::ExtraToken {
                token: (start, token, end),
            } =&gt; ParseError::UnexpectedToken(
                UnexpectedTokenData {
                    token: token.to_string().into(),
                }
                .to_located(start.into()..end.into()),
            ),

            lalrpop_util::ParseError::User { error } =&gt; error,
        }
    }
}

<span class="attr">#[cfg(test)]
</span><span class="kw">mod </span>tests {
    <span class="kw">use super</span>::<span class="kw-2">*</span>;
    <span class="kw">fn </span>parse_partiql(s: <span class="kw-2">&amp;</span>str) -&gt; AstResult {
        <span class="kw">super</span>::parse_partiql(s)
    }

    <span class="macro">macro_rules! </span>parse {
        (<span class="macro-nonterminal">$q</span>:expr) =&gt; {{
            <span class="kw">let </span>res = parse_partiql(<span class="macro-nonterminal">$q</span>);
            <span class="macro">println!</span>(<span class="string">&quot;{:#?}&quot;</span>, res);
            <span class="kw">match </span>res {
                <span class="prelude-val">Ok</span>(data) =&gt; data.ast,
                <span class="kw">_ </span>=&gt; <span class="macro">panic!</span>(<span class="string">&quot;{:?}&quot;</span>, res),
            }
        }};
    }

    <span class="kw">mod </span>literals {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>null() {
            <span class="macro">parse!</span>(<span class="string">&quot;NULL&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>missing() {
            <span class="macro">parse!</span>(<span class="string">&quot;MISSING&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>true_() {
            <span class="macro">parse!</span>(<span class="string">&quot;TRUE&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>false_() {
            <span class="macro">parse!</span>(<span class="string">&quot;FALSE&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>string() {
            <span class="macro">parse!</span>(<span class="string">&quot;&#39;foo&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;&#39;embe&#39;&#39;ded&#39;&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>numeric() {
            <span class="macro">parse!</span>(<span class="string">&quot;42&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;7.&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;.00125&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;5.5&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;17e2&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;1.317e-3&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;3141.59265e-03&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>time() {
            <span class="macro">parse!</span>(<span class="string">&quot;time &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time(10) &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time WITH TIME ZONE &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time WITHOUT TIME ZONE &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time(10) WITH TIME ZONE &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time(10) WITHOUT TIME ZONE &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time (10) WITH TIME ZONE &#39;22:12&#39;&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">&quot;time (10) WITHOUT TIME ZONE &#39;22:12&#39;&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>ion() {
            <span class="macro">parse!</span>(<span class="string">r#&quot; `[{&#39;a&#39;:1, &#39;b&#39;:1}, {&#39;a&#39;:2}, &quot;foo&quot;]` &quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot; `[{&#39;a&#39;:1, &#39;b&#39;:1}, {&#39;a&#39;:2}, &quot;foo&quot;, &#39;a`b&#39;, &quot;a`b&quot;, &#39;&#39;&#39;`s&#39;&#39;&#39;, {{&quot;a`b&quot;}}]` &quot;#</span>);
            <span class="macro">parse!</span>(
                <span class="string">r#&quot; `{&#39;a&#39;:1, // comment &#39; &quot;
                      &#39;b&#39;:1} ` &quot;#
            </span>);
            <span class="macro">parse!</span>(
                <span class="string">r#&quot; `{&#39;a&#39; // comment &#39; &quot;
                       :1, /* 
                               comment 
                              */
                      &#39;b&#39;:1} ` &quot;#
            </span>);
        }
    }

    <span class="kw">mod </span>non_literal_values {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>identifier() {
            <span class="macro">parse!</span>(<span class="string">&quot;id&quot;</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;&quot;quoted_id&quot;&quot;#</span>);
        }
        <span class="attr">#[test]
        </span><span class="kw">fn </span>array() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;[]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;[1, &#39;moo&#39;, &quot;some variable&quot;, [], &#39;a&#39;, MISSING]&quot;#</span>);
            <span class="comment">// In the interest of compatibility to SQL, PartiQL also allows array constructors to be
            // denoted with parentheses instead of brackets, when there are at least two elements in the array
            </span><span class="macro">parse!</span>(<span class="string">r#&quot;(1, &#39;moo&#39;, &quot;some variable&quot;, [], &#39;a&#39;, MISSING)&quot;#</span>);
        }
        <span class="attr">#[test]
        </span><span class="kw">fn </span>bag() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;&lt;&lt;&gt;&gt;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;&lt;&lt;1&gt;&gt;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;&lt;&lt;1,2&gt;&gt;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;&lt;&lt;1, &lt;&lt;&gt;&gt;, &#39;boo&#39;, some_variable, &#39;a&#39;&gt;&gt;&quot;#</span>);
        }
        <span class="attr">#[test]
        </span><span class="kw">fn </span>tuple() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;{}&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{a_variable: 1, &#39;cow&#39;: &#39;moo&#39;, &#39;a&#39;: NULL}&quot;#</span>);
        }
    }

    <span class="kw">mod </span>expr {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>or_simple() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;TRUE OR FALSE&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>or() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;t1.super OR test(t2.name, t1.name)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>and_simple() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;TRUE and FALSE&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>and() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;test(t2.name, t1.name) AND t1.id = t2.id&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>or_and() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;t1.super OR test(t2.name, t1.name) AND t1.id = t2.id&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>infix() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;1 + -2 * +3 % 4^5 / 6 - 7  &lt;= 3.14 AND &#39;foo&#39; || &#39;bar&#39; LIKE &#39;%oba%&#39;&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>expr_in() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;a in (1,2,3,4)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a in [1,2,3,4]&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>expr_between() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;a between 2 and 3&quot;#</span>);
        }
    }

    <span class="kw">mod </span>pathexpr {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>nested() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.c[&#39;item&#39;].&quot;d&quot;[5].e[&#39;s&#39;].f[1+2]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.*&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b[*]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;@a.b[*]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;@&quot;a&quot;.b[*]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;tables.items[*].product.*.nest&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.c[&#39;item&#39;].&quot;d&quot;[5].e[&#39;s&#39;].f[1+2]&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>tuple() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;a&#39;:1 , &#39;data&#39;: 2}.a&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;a&#39;:1 , &#39;data&#39;: 2}.&#39;a&#39;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;A&#39;:1 , &#39;data&#39;: 2}.&quot;A&quot;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;A&#39;:1 , &#39;data&#39;: 2}[&#39;a&#39;]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;attr&#39;: 1, &#39;b&#39;:2}[v || w]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;{&#39;a&#39;:1, &#39;b&#39;:2}.*&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>array() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;[1,2,3][0]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;[1,2,3][1 + 1]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;[1,2,3][*]&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>query() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t).a&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t).&#39;a&#39;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t).&quot;a&quot;&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t)[&#39;a&#39;]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t).*&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;(SELECT a FROM t)[*]&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>function_call() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y).a&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y).*&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y)[*]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y)[5]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y).a.*&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;foo(x, y)[*].*.b[5]&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>test_pathexpr_struct() {
            <span class="kw">let </span>res = <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.c[&#39;item&#39;].&quot;d&quot;[5].e[&#39;s&#39;].f[1+2]&quot;#</span>);

            <span class="kw">if let </span>ast::AstNode {
                node:
                    ast::TopLevelQuery {
                        query:
                            ast::AstNode {
                                node:
                                    ast::Query {
                                        set:
                                            ast::AstNode {
                                                node: ast::QuerySet::Expr(<span class="kw-2">ref </span>e),
                                                ..
                                            },
                                        ..
                                    },
                                ..
                            },
                        ..
                    },
                ..
            } = res
            {
                <span class="kw">if let </span>ast::Expr::Path(p) = <span class="kw-2">&amp;**</span>e {
                    <span class="macro">assert_eq!</span>(<span class="number">9</span>, p.node.steps.len())
                } <span class="kw">else </span>{
                    <span class="macro">panic!</span>(<span class="string">&quot;PathExpr test failed!&quot;</span>);
                }
            } <span class="kw">else </span>{
                <span class="macro">panic!</span>(<span class="string">&quot;PathExpr test failed!&quot;</span>);
            }
        }

        <span class="attr">#[test]
        #[should_panic]
        </span><span class="kw">fn </span>erroneous() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.[&#39;item&#39;]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.{&#39;a&#39;: 1, &#39;b&#39;: 2}.a&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.[1, 2, 3][2]&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;a.b.[*]&quot;#</span>);
        }
    }

    <span class="kw">mod </span>sfw {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>selectstar() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT *&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select1() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT g&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select_list() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT g, k as ck, h&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>fun_call() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;fun_call(&#39;bar&#39;, 1,2,3,4,5,&#39;foo&#39;)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select3() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT g, k, function(&#39;2&#39;) as fn_result&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>group() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT g FROM data GROUP BY a&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>group_complex() {
            <span class="macro">parse!</span>(<span class="string">&quot;SELECT g FROM data GROUP BY a AS x, b + c AS y, foo(d) AS z GROUP AS g&quot;</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>order_by() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT a FROM tb ORDER BY PRESERVE&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT a FROM tb ORDER BY rk1&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT a FROM tb ORDER BY rk1 ASC, rk2 DESC&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>where_simple() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT a FROM tb WHERE hk = 1&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>where_boolean() {
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;SELECT a FROM tb WHERE t1.super OR test(t2.name, t1.name) AND t1.id = t2.id&quot;#
            </span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>limit() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT * FROM a LIMIT 10&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>offset() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT * FROM a OFFSET 10&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>limit_offset() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT * FROM a LIMIT 10 OFFSET 2&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>complex() {
            <span class="kw">let </span>q = <span class="string">r#&quot;
            SELECT (
                SELECT numRec, data
                FROM delta_full_transactions.deltas delta0,
                (
                    SELECT u.id, review, rindex
                    FROM delta1.data as u CROSS JOIN UNPIVOT u.reviews as review AT rindex
                ) as data,
                delta2.numRec as numRec
            )
            AS deltas FROM SOURCE_VIEW_DELTA_FULL_TRANSACTIONS delta_full_transactions
            &quot;#</span>;
            <span class="macro">parse!</span>(q);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select_with_case() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT a WHERE CASE WHEN x &lt;&gt; 0 THEN y/x &gt; 1.5 ELSE false END&quot;#</span>);
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;SELECT a,
                    CASE WHEN a=1 THEN &#39;one&#39;
                         WHEN a=2 THEN &#39;two&#39;
                         ELSE &#39;other&#39;
                    END
                    FROM test&quot;#
            </span>);

            <span class="macro">parse!</span>(
                <span class="string">r#&quot;SELECT VALUE
                    {
                        &#39;locationType&#39;: R.LocationType,
                        &#39;Location&#39;: (
                            CASE WHEN id IS NOT NULL THEN
                                (SELECT VALUE (CASE WHEN R.LocationType = &#39;z&#39; THEN n ELSE d END)
                                FROM R.Scope AS scope WHERE scope.name = id)
                            ELSE
                                (SELECT VALUE (CASE WHEN R.LocationType = &#39;z&#39; THEN n ELSE d END)
                                FROM R.Scope AS scope WHERE scope.name = someZone)
                            END
                        ),
                        &#39;marketType&#39; : MarketInfo.marketType,
                    }
                    FROM UNPIVOT R.returnValueMap.success AS &quot;list&quot; AT symb&quot;#
            </span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select_with_cross_join_and_at() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT * FROM a AS a CROSS JOIN c AS c AT q&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>select_with_at_and_cross_join_and_at() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT * FROM a AS a AT b CROSS JOIN c AS c AT q&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>multiline_with_comments() {
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;SELECT * FROM hr.employees               -- T1
                                  UNION
                                  SELECT title FROM engineering.employees  -- T2&quot;#
            </span>);
        }
    }

    <span class="kw">mod </span>set_ops {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;
        <span class="kw">use </span>partiql_ast::ast::NodeId;

        <span class="attr">#[derive(Default)]
        </span><span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct </span>NullIdGenerator {}

        <span class="kw">impl </span>IdGenerator <span class="kw">for </span>NullIdGenerator {
            <span class="kw">fn </span>id(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; NodeId {
                NodeId(<span class="number">0</span>)
            }
        }

        <span class="kw">impl</span>&lt;<span class="lifetime">&#39;input</span>&gt; ParserState&lt;<span class="lifetime">&#39;input</span>, NullIdGenerator&gt; {
            <span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">fn </span>new_null_id() -&gt; ParserState&lt;<span class="lifetime">&#39;input</span>, NullIdGenerator&gt; {
                ParserState::with_id_gen(NullIdGenerator::default())
            }
        }

        <span class="kw">fn </span>parse_partiql_null_id(s: <span class="kw-2">&amp;</span>str) -&gt; AstResult {
            <span class="kw">super</span>::parse_partiql_with_state(s, ParserState::new_null_id())
        }

        <span class="comment">// parse partiql query with all AST nodes having an id of `0` for ease of comparison regardless
        //   of parse order
        </span><span class="macro">macro_rules! </span>parse_null_id {
            (<span class="macro-nonterminal">$q</span>:expr) =&gt; {{
                <span class="kw">let </span>res = parse_partiql_null_id(<span class="macro-nonterminal">$q</span>);
                <span class="macro">println!</span>(<span class="string">&quot;{:#?}&quot;</span>, res);
                <span class="kw">match </span>res {
                    <span class="prelude-val">Ok</span>(data) =&gt; data.ast,
                    <span class="kw">_ </span>=&gt; <span class="macro">panic!</span>(<span class="string">&quot;{:?}&quot;</span>, res),
                }
            }};
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>set_ops() {
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;(SELECT * FROM a LIMIT 10 OFFSET 2) UNION SELECT * FROM b INTERSECT c EXCEPT SELECT * FROM d&quot;#
            </span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>union_prec() {
            <span class="kw">let </span>l = <span class="macro">parse_null_id!</span>(<span class="string">r#&quot;a union b union c&quot;#</span>);
            <span class="kw">let </span>r = <span class="macro">parse_null_id!</span>(<span class="string">r#&quot;(a union b) union c&quot;#</span>);
            <span class="macro">assert_eq!</span>(l, r);
        }

        <span class="comment">// TODO: will need to fix set op precedence after parse (parser was changed to support `OUTER UNION/INTERSECT/EXCEPT`
        </span><span class="attr">#[test]
        #[ignore]
        </span><span class="kw">fn </span>intersec_prec() {
            <span class="kw">let </span>l = <span class="macro">parse_null_id!</span>(<span class="string">r#&quot;a union b intersect c&quot;#</span>);
            <span class="kw">let </span>r = <span class="macro">parse_null_id!</span>(<span class="string">r#&quot;a union (b intersect c)&quot;#</span>);
            <span class="macro">assert_eq!</span>(l, r);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>limit() {
            <span class="kw">let </span>l = <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;SELECT a FROM b UNION SELECT x FROM y ORDER BY a LIMIT 10 OFFSET 5&quot;#
            </span>);
            <span class="kw">let </span>r = <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;(SELECT a FROM b UNION SELECT x FROM y) ORDER BY a LIMIT 10 OFFSET 5&quot;#
            </span>);
            <span class="macro">assert_eq!</span>(l, r);
            <span class="kw">let </span>r2 = <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;SELECT a FROM b UNION (SELECT x FROM y ORDER BY a LIMIT 10 OFFSET 5)&quot;#
            </span>);
            <span class="macro">assert_ne!</span>(l, r2);
            <span class="macro">assert_ne!</span>(r, r2);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>complex_set() {
            <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;(SELECT a1 FROM b1 ORDER BY c1 LIMIT d1 OFFSET e1)
                   OUTER UNION ALL
                   (SELECT a2 FROM b2 ORDER BY c2 LIMIT d2 OFFSET e2)
                   ORDER BY c3 LIMIT d3 OFFSET e3&quot;#
            </span>);
            <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;(SELECT a1 FROM b1 ORDER BY c1 LIMIT d1 OFFSET e1)
                   OUTER INTERSECT ALL
                   (SELECT a2 FROM b2 ORDER BY c2 LIMIT d2 OFFSET e2)
                   ORDER BY c3 LIMIT d3 OFFSET e3&quot;#
            </span>);
            <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;(SELECT a1 FROM b1 ORDER BY c1 LIMIT d1 OFFSET e1)
                   OUTER EXCEPT ALL
                   (SELECT a2 FROM b2 ORDER BY c2 LIMIT d2 OFFSET e2)
                   ORDER BY c3 LIMIT d3 OFFSET e3&quot;#
            </span>);
            <span class="macro">parse_null_id!</span>(
                <span class="string">r#&quot;(
                       (SELECT a1 FROM b1 ORDER BY c1 LIMIT d1 OFFSET e1)
                       UNION DISTINCT
                       (SELECT a2 FROM b2 ORDER BY c2 LIMIT d2 OFFSET e2)
                   )
                   OUTER UNION ALL
                   (SELECT a3 FROM b3 ORDER BY c3 LIMIT d3 OFFSET e3)
                   ORDER BY c4 LIMIT d4 OFFSET e4&quot;#
            </span>);
        }
    }

    <span class="kw">mod </span>case_expr {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>searched_case() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;CASE WHEN TRUE THEN 2 END&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CASE WHEN id IS 1 THEN 2 WHEN titanId IS 2 THEN 3 ELSE 1 END&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CASE hello WHEN id IS NOT NULL THEN (SELECT * FROM data) ELSE 1 END&quot;#</span>);
        }

        <span class="attr">#[test]
        #[should_panic]
        </span><span class="kw">fn </span>searched_case_failure() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;CASE hello WHEN id IS NOT NULL THEN SELECT * FROM data ELSE 1 END&quot;#</span>);
        }
    }

    <span class="kw">mod </span>nonuniform {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>position() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;position(&#39;oB&#39; in &#39;FooBar&#39;)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>substring() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;substring(&#39;FooBar&#39; from 2 for 3)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;substring(&#39;FooBar&#39; from 2)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;substring(&#39;FooBar&#39; for 3)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>trim() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(LEADING &#39;Foo&#39; from &#39;FooBar&#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(leading from &#39;   Bar&#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(TrAiLiNg &#39;Bar&#39; from &#39;FooBar&#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(TRAILING from &#39;Bar   &#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(BOTH &#39;Foo&#39; from &#39;FooBarBar&#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(botH from &#39;   Bar   &#39;)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;trim(from &#39;   Bar   &#39;)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>cast() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(9 AS b)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS VARCHAR)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS VARCHAR(20))&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS TIME)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS TIME(20))&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST( TRUE AS INTEGER)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST( (4 in (1,2,3,4)) AS INTEGER)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS TIME WITH TIME ZONE)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS TIME WITH TIME ZONE)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;CAST(a AS TIME(20) WITH TIME ZONE)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>extract() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;extract(day from a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;extract(hour from a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;extract(minute from a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;extract(second from a)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>agg() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;count(a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;count(distinct a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;count(all a)&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;count(*)&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>composed() {
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;cast(trim(LEADING &#39;Foo&#39; from substring(&#39;BarFooBar&#39; from 4 for 6)) AS VARCHAR(20))&quot;#
            </span>);
        }
    }

    <span class="doccomment">/// In the future, the following identifiers may be converted into reserved keywords. In that case,
    /// the following tests will need to be modified.
    </span><span class="kw">mod </span>non_reserved_keywords {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>projection_list_trim_spec() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT leading FROM t&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT leading, a FROM t&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT leading + trailing, b FROM t&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT both + leading + trailing, a, b, c FROM t&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>from_source_trim_spec() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT leading, trailing, both FROM leading, trailing, both&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>complex_trim() {
            <span class="macro">parse!</span>(
                <span class="string">r#&quot;SELECT leading + trim(leading leading FROM &#39;  hello world&#39;), both FROM leading, trailing, both&quot;#
            </span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>graph_pattern_matching() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT acyclic, trail, simple FROM t&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;AcYcLiC&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;TrAiL&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;SiMpLe&quot;#</span>);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>user_public_domain() {
            <span class="macro">parse!</span>(<span class="string">r#&quot;SELECT user, puBlIC, DOMAIN FROM USER, pUbLIc, domain&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;USER&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;pUbLIC&quot;#</span>);
            <span class="macro">parse!</span>(<span class="string">r#&quot;domain&quot;#</span>);
        }
    }

    <span class="kw">mod </span>errors {
        <span class="kw">use super</span>::<span class="kw-2">*</span>;
        <span class="kw">use </span><span class="kw">crate</span>::error::{LexError, UnexpectedToken, UnexpectedTokenData};
        <span class="kw">use </span>partiql_source_map::location::{Located, Location};
        <span class="kw">use </span>std::borrow::Cow;

        <span class="attr">#[test]
        </span><span class="kw">fn </span>eof() {
            <span class="kw">let </span>res = parse_partiql(<span class="string">r#&quot;SELECT&quot;#</span>);
            <span class="macro">assert!</span>(res.is_err());
            <span class="kw">let </span>err_data = res.unwrap_err();
            <span class="macro">assert_eq!</span>(<span class="number">1</span>, err_data.errors.len());
            <span class="macro">assert_eq!</span>(err_data.errors[<span class="number">0</span>], ParseError::UnexpectedEndOfInput);
        }

        <span class="attr">#[test]
        </span><span class="kw">fn </span>unterminated_ion_unicode() {
            <span class="kw">let </span>q = <span class="string">r#&quot;/`܋&quot;#</span>;
            <span class="kw">let </span>res = parse_partiql(q);
            <span class="macro">assert!</span>(res.is_err());
            <span class="kw">let </span>err_data = res.unwrap_err();
            <span class="macro">assert_eq!</span>(<span class="number">2</span>, err_data.errors.len());
            <span class="macro">assert_eq!</span>(
                err_data.errors[<span class="number">0</span>],
                ParseError::UnexpectedToken(UnexpectedToken {
                    inner: UnexpectedTokenData {
                        token: Cow::from(<span class="string">&quot;/&quot;</span>)
                    },
                    location: Location {
                        start: BytePosition::from(<span class="number">0</span>),
                        end: BytePosition::from(<span class="number">1</span>),
                    },
                })
            );
            <span class="macro">assert_eq!</span>(
                err_data.errors[<span class="number">1</span>],
                ParseError::LexicalError(Located {
                    inner: LexError::UnterminatedIonLiteral,
                    location: Location {
                        start: BytePosition::from(<span class="number">1</span>),
                        end: BytePosition::from(<span class="number">4</span>),
                    },
                })
            );
        }
    }
}
</code></pre></div></section></main></body></html>