<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Helper module for splitting records across multiple key-value pairs."><title>fdb_rl::split_helper - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-9ee3a5e31a2afa3e.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="fdb_rl" data-themes="" data-resource-suffix="" data-rustdoc-version="1.75.0-nightly (df871fbf0 2023-10-24)" data-channel="nightly" data-search-js="search-8fbf244ebcf71464.js" data-settings-js="settings-74424d7eec62a23e.js" ><script src="../../static.files/storage-fec3eaa3851e447d.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-5f34af1a0ee6bacd.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../fdb_rl/index.html">fdb_rl</a><span class="version">0.1.0</span></h2></div><h2 class="location"><a href="#">Module split_helper</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate fdb_rl</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press â€˜Sâ€™ to search, â€˜?â€™ for more optionsâ€¦" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">fdb_rl</a>::<wbr><a class="mod" href="#">split_helper</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/fdb_rl/split_helper/mod.rs.html#1-911">source</a> Â· <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Helper module for splitting records across multiple key-value pairs.</p>
<p>FoundationDB has key-value size <a href="https://apple.github.io/foundationdb/known-limitations.html#large-keys-and-values">limitation</a> of 10KB and 100KB
respectively. While we do not explicitly check the size of our
keys, this module provides functions that when required will split
serialized record into multiple 100KB chunks and spreads them
across multiple key-value pairs.</p>
<p>This is done by adding a suffix to the key. The keyspace for a
record is organized as shown below.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>|------------------------------+---------------------|
| Key                          | Value               |
|------------------------------+---------------------|
| (Subspace, Primary Key, -<span class="number">1</span>,) | Record header       |
|------------------------------+---------------------|
| (Subspace, Primary Key, <span class="number">0</span>,)  | <span class="number">100KB </span>chunk or less |
|------------------------------+---------------------|
| (Subspace, Primary Key, <span class="number">1</span>,)  | <span class="number">100KB </span>chunk or less |
|------------------------------+---------------------|
| (Subspace, Primary Key, <span class="number">2</span>,)  | <span class="number">100KB </span>chunk or less |
|------------------------------+---------------------|
| ...                          | ...                 |
| ...                          | ...                 |
|------------------------------+---------------------|</code></pre></div>
<p>There is a record header at suffix of <code>-1</code>. The record header is a
tuple of the form:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>(header_version, data_splits, incarnation, versionstamp)</code></pre></div>
<ul>
<li>
<p>The <code>header_version</code> is a number describing the version of the
header. The form described above is <code>header_version</code> of <code>0</code>.</p>
</li>
<li>
<p><code>data_splits</code> is the number of splits of data that is contained
within this record. At a minimum, a record will have atleast one
data split. This is true <em>even</em> in case of an empty record.</p>
</li>
<li>
<p><code>incarnation</code> is the incarnation of the record. Incarnation is
managed using <a href="../record_context/struct.RecordContext.html" title="struct fdb_rl::record_context::RecordContext"><code>RecordContext</code></a> and is incremented each time a
record is migrated between FoundationDB clusters.</p>
</li>
<li>
<p>The <code>versionstamp</code> contains information about
<a href="../record_version/struct.RecordVersion.html" title="struct fdb_rl::record_version::RecordVersion"><code>RecordVersion</code></a>â€™s global version and local version.</p>
</li>
</ul>
<p>There is <em>no</em> tuple encoding for the data. That is <em>100KB chunk or
less</em> value is stored in the raw format. This is because tuple
encoding would introduce escape sequences which depending on the
data might exceed the 100KB limit.</p>
<p><strong>Note:</strong> In the key that gets generated, we flatten the primary
key tuple when suffix is appended to it. The primary key is not a
<em>nested</em> tuple.</p>
<p>A minimal record will be of the form</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>|------------------------------+---------------|
| Key                          | Value         |
|------------------------------+---------------|
| (Subspace, Primary Key, -<span class="number">1</span>,) | Record header |
|------------------------------+---------------|
| (Subspace, Primary Key, <span class="number">0</span>,)  | <span class="string">&quot;&quot;            </span>|
|------------------------------+---------------|</code></pre></div>
<p>The functions <a href="fn.load.html" title="fn fdb_rl::split_helper::load"><code>load</code></a>, <a href="fn.save.html" title="fn fdb_rl::split_helper::save"><code>save</code></a> and <a href="fn.delete.html" title="fn fdb_rl::split_helper::delete"><code>delete</code></a> does not take a
value of <a href="../raw_record/primary_key/struct.RawRecordPrimaryKeySchema.html" title="struct fdb_rl::raw_record::primary_key::RawRecordPrimaryKeySchema"><code>RawRecordPrimaryKeySchema</code></a> as its
argument. <strong>However</strong> its implementation assumes that you are
adhering to <em>primary key schema constraint</em> as mentioned in the
documentation for <a href="../raw_record/struct.RawRecord.html" title="struct fdb_rl::raw_record::RawRecord"><code>RawRecord</code></a>.</p>
<p style="background:rgba(255,181,77,0.16);padding:0.75em;">
<strong>Warning:</strong> Functions in this module are
<strong>not</strong> meant to be public. We need to make functions
in this module public to support integration tests. Do not use
functions in this module in your code.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="error/index.html" title="mod fdb_rl::split_helper::error">error</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Provides error constants for split helper module.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.RecordHeaderV0.html" title="struct fdb_rl::split_helper::RecordHeaderV0">RecordHeaderV0</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">Record header version <code>0</code>.</div></li></ul><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><ul class="item-table"><li><div class="item-name"><a class="constant" href="constant.SPLIT_RECORD_SIZE.html" title="constant fdb_rl::split_helper::SPLIT_RECORD_SIZE">SPLIT_RECORD_SIZE</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> </div><div class="desc docblock-short">If a record is greater than this size (in bytes) it will be split
into multiple key-value pairs.</div></li></ul><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.delete.html" title="fn fdb_rl::split_helper::delete">delete</a></div><div class="desc docblock-short">Delete the serialized representation of a record.</div></li><li><div class="item-name"><a class="fn" href="fn.delete_unchecked.html" title="fn fdb_rl::split_helper::delete_unchecked">delete_unchecked</a><span title="Restricted Visibility">&nbsp;ðŸ”’</span> <sup title="unsafe function">âš </sup></div><div class="desc docblock-short">Delete the serialized representation of a record <strong>without</strong> any
safety checks.</div></li><li><div class="item-name"><a class="fn" href="fn.load.html" title="fn fdb_rl::split_helper::load">load</a></div><div class="desc docblock-short">Load serialized byte array that may be split among several keys.</div></li><li><div class="item-name"><a class="fn" href="fn.save.html" title="fn fdb_rl::split_helper::save">save</a></div><div class="desc docblock-short">Save serialized representation using multiple keys if necessary.</div></li></ul></section></div></main></body></html>